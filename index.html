<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pelada dos Pilantras PRO</title>
    
    <link rel="stylesheet" href="estilo.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

    <div id="telaLogin">
        <div style="text-align:center;">
            <h1>üîí Acesso Restrito</h1>
            <p>Digite a senha da pelada</p>
            <input type="password" id="senhaAcesso" placeholder="Senha..." onkeyup="if(event.key==='Enter') verificarSenha()">
            <br><br>
            <button class="btn-zao" onclick="verificarSenha()">ENTRAR</button>
            <p id="erroLogin" style="color:red; display:none; margin-top:10px;">Senha incorreta!</p>
        </div>
    </div>

    <div class="header">
        <button class="btn-icon" onclick="abrirAjuda()">‚ùì</button>
        <h1>‚öΩ Pelada PRO</h1>
        <button class="btn-icon" onclick="alternarTema()">üåó</button>
    </div>

    <div class="placar">
        <span id="tempo">10:00</span>
        <div class="controles-timer">
            <button class="btn-play" onclick="iniciarTimer()">‚ñ∂</button>
            <button class="btn-pause" onclick="pausarTimer()">‚è∏</button>
            <button class="btn-reset" onclick="resetarTimer()">‚Ü∫</button>
            <button onclick="adicionarMinuto()" style="background:#333; color:#fff;">+1m</button>
            <button onclick="mudarTempoPadrao(prompt('Quantos minutos?', '10'))" style="background:#333; color:#fff;">‚è±Ô∏è Cfg</button>
        </div>
    </div>

    <div class="area-titulo">JOGANDO AGORA</div>
    <div id="jogando" class="container-times"></div>

    <button class="btn-zao-verde" onclick="timeGanhou()">üèÜ ALGU√âM GANHOU!</button>
    <button class="btn-zao-cinza" onclick="empate()">ü§ù EMPATE (SAEM OS 2)</button>

    <div class="area-titulo">PR√ìXIMOS TIMES</div>
    <div id="proxima" class="container-times"></div>
    
    <div style="display:flex; gap:10px; margin-top:10px;">
        <input type="text" id="nomeTime" placeholder="Nome do Time..." style="flex:1; padding:10px; border-radius:8px; border:none;">
        <button onclick="adicionarTime()" style="background:var(--accent); color:#fff;">Criar Time</button>
    </div>

    <div class="area-titulo" style="margin-top:30px;">SOBRANDO / DE FORA</div>
    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <input type="text" id="nomeJogador" placeholder="Nome do jogador..." style="flex:1; padding:10px; border-radius:8px; border:none;" onkeyup="if(event.key==='Enter') adicionarJogador()">
        <button onclick="adicionarJogador()" style="background:var(--accent); color:#fff;">+</button>
    </div>
    
    <div id="sobrando" class="lista-jogadores" style="min-height:50px; background:rgba(0,0,0,0.1); border-radius:10px; padding:10px;"></div>

    <br>
    <button class="btn-zao" onclick="sortearTimes()">üé≤ SORTEAR TIMES</button>

    <div class="area-titulo" style="margin-top:40px;">RANKING GERAL</div>
    <div id="ranking" style="background:var(--card); padding:15px; border-radius:10px;"></div>
    <button onclick="gerarPrintRanking()" style="width:100%; margin-top:10px; background:#444; color:#fff; padding:10px; border-radius:8px;">üì∏ Baixar Imagem do Ranking</button>

    <br><br><br>
    <button onclick="resetarTudo()" style="width:100%; background:#ef4444; color:#fff; padding:15px; border-radius:8px;">‚ö†Ô∏è RESETAR TUDO (PERIGO)</button>

    <audio id="somFim" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/buzzer.ogg" type="audio/ogg">
        <source src="https://actions.google.com/sounds/v1/alarms/buzzer.mp3" type="audio/mpeg">
    </audio>

    <div id="modalVitoria" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; flex-direction:column; justify-content:center; align-items:center;">
        <h2 style="color:white; margin-bottom:20px;">QUEM GANHOU?</h2>
        <div id="opcoesVitoria" style="width:80%; display:flex; flex-direction:column; gap:10px;"></div>
        <button onclick="fecharModalVitoria()" style="margin-top:20px; background:red; color:white; padding:10px 30px;">Cancelar</button>
    </div>

    <div id="modalAjuda" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:3000; flex-direction:column; justify-content:center; align-items:center; padding:20px; text-align:center; color:white;">
        <h2>Como usar</h2>
        <p>1. Adicione os jogadores na lista de espera.</p>
        <p>2. Clique em "Sortear Times" ou crie times manualmente.</p>
        <p>3. Arraste os times para "Jogando Agora".</p>
        <p>4. Solte o cron√¥metro!</p>
        <button onclick="fecharAjuda()" style="background:var(--accent); color:white; padding:10px 30px; margin-top:20px;">Entendi</button>
    </div>

    <script type="module">
        // 1. IMPORTAR FIREBASE
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 2. CONFIGURA√á√ÉO (COLE SUAS CHAVES AQUI!!!)
        const firebaseConfig = {
            apiKey: "AIzaSyDHpJlzcM3zta6R9h5dq6HiojXdodTT1O8",
            authDomain: "peladapilantraspro.firebaseapp.com",
            databaseURL: "https://peladapilantraspro-default-rtdb.firebaseio.com",
            projectId: "peladapilantraspro",
            storageBucket: "peladapilantraspro.firebasestorage.app",
            messagingSenderId: "444542616913",
            appId: "1:444542616913:web:16a9f42f0d85f21371bf70"
};

        // 3. INICIALIZAR
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const peladaRef = ref(db, 'partida_atual');

        console.log("üî• Firebase Iniciado!");

        // 4. FUN√á√ÉO PARA ENVIAR (Global)
        window.enviarParaNuvem = function(dados) {
            set(peladaRef, dados)
                .then(() => console.log("Dado enviado com sucesso!"))
                .catch((e) => console.error("Erro ao enviar:", e));
        };

        // 5. FUN√á√ÉO PARA RECEBER (Ouvido Bionico)
        onValue(peladaRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                console.log("üì° DADOS RECEBIDOS:", data);
                
                // Atualiza as vari√°veis GLOBAIS que o script.js usa
                window.estado = data;
                
                // Manda o script.js desenhar a tela (sem salvar de volta pra n√£o dar loop)
                if (typeof window.renderizar === "function") {
                    window.renderizar(false); 
                }
            }
        });
    </script>

    <script src="script.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</body>
</html>